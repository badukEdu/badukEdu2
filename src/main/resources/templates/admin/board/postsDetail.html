<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">

<section layout:fragment="content">
<h2>게시글 상세 조회</h2>

<div th:if="${noticeDetail}">
    <table class="table_rows">
        <tr>
            <td>게시글 번호:</td>
            <td><span th:text="${noticeDetail.num}"></span></td>
        </tr>
        <tr>
            <td>작성자:</td>
            <td th:text="${noticeDetail.member != null ? noticeDetail.member.userId : '작성자 정보 없음'}"></td>
        </tr>
        <tr>
            <td>공지 분류:</td>
            <td><span th:text="${noticeDetail.type}"></span></td>
        </tr>
        <tr>
            <td>노출 여부:</td>
            <td><span th:if="${noticeDetail.onTop}">O</span><span th:unless="${noticeDetail.onTop}">X</span></td>
        </tr>
        <tr>
            <td>제목:</td>
            <td><span th:text="${noticeDetail.title}"></span></td>
        </tr>
<!--        <tr>-->
<!--            <td>내용:</td>-->
<!--            <td><span th:text="${noticeDetail.content}"></span></td>-->
<!--        </tr>-->
        <!-- 추가 필드가 있다면 추가 -->
    </table>
</div>
<div> <!--  th:if="${@memberUtils.isAdmin()}" 권한에 맞게 뷰 띄우기 -->
    <form th:action="@{/admin/board/edit/{num}(num=${noticeDetail.num})}" method="get">
        <input type="submit" value="수정하기">
    </form>
    <a th:href="@{/admin/board/delete/{num}(num=*{num})}" onclick="return confirm('정말 삭제하시겠습니까?');">
        <i class="xi-trash"></i> 삭제하기
    </a>
</div>

<script>

    /* 새로 만든 파일 첨부 버튼 S */
document.addEventListener('DOMContentLoaded', function() {
document.getElementById('uploadButton').addEventListener('click', function() {
document.getElementById('uploadFile').click();
});
});
/* 새로 만든 파일 첨부 버튼 E */


/* 파일 드롭 영역 이벤트 처리 S */
document.addEventListener('DOMContentLoaded', function() {
// 파일 드롭 영역 선택
const dropArea = document.getElementById('dropArea');

// 파일 선택 input 요소
const fileInput = document.getElementById('uploadFile');

// 파일 정보를 표시하는 요소
const fileInfo = document.getElementById('fileInfo');

// 파일 드롭 이벤트 처리
dropArea.addEventListener('dragover', function(e) {
e.preventDefault();
dropArea.classList.add('dragover');
});

dropArea.addEventListener('dragleave', function() {
dropArea.classList.remove('dragover');
});

dropArea.addEventListener('drop', function(e) {
e.preventDefault();
dropArea.classList.remove('dragover');

// 드롭된 파일 정보 가져오기
const files = e.dataTransfer.files;

// 파일 정보 표시
if (files.length > 0) {
    const fileName = files[0].name;
    fileInfo.textContent = '선택된 파일: ' + fileName;

//            const formData = new FormData();
//            for (const file of files) {
//                formData.append("file", file);
//            }

} else {
    fileInfo.textContent = '선택된 파일 없음';
}
});
});
/* 파일 드롭 영역 이벤트 처리 E */


/* 파일 첨부 및 검증 S */
document.addEventListener('DOMContentLoaded', function() {
// 파일 선택 input 요소
const fileInput = document.getElementById('uploadFile');

/*
파일 선택 버튼 필요 시 주석 풀고 사용
const uploadButton = document.getElementById('uploadButton');
*/

// 파일 정보를 표시하는 요소
const fileInfo = document.getElementById('fileInfo');

// 파일이 선택되면 파일 정보를 표시하는 함수
fileInput.addEventListener('change', function() {
// 파일이 선택되었는지 확인
if (fileInput.files.length > 0) {
    // 선택된 파일의 정보 가져오기
    const selectedFile = fileInput.files[0];
    const fileName = selectedFile.name;
    const fileSize = selectedFile.size; // 파일 크기 (바이트 단위)

    // 파일 크기를 MB 단위로 변환
    const fileSizeInMB = fileSize / (1024 * 1024);

    // 파일 이름 표시
    fileInfo.textContent = '첨부된 파일: ' + fileName;

    // 파일 크기가 30MB를 초과하는지 확인
    if (fileSizeInMB > 30) {
        // 경고 메시지 표시
        alert('첨부할 수 있는 파일의 크기를 초과하였습니다.');
        // 파일 선택 취소
        fileInput.value = "";
        // 파일 정보 초기화
        fileInfo.textContent = '선택된 파일 없음';
    }
} else {
    // 파일이 선택되지 않은 경우 버튼 초기값으로 설정
    fileInfo.textContent = '선택된 파일 없음';
}
});

// 비우기 버튼 클릭 시 첨부된 파일 지우기
const clearButton = document.getElementById('clearButton');
clearButton.addEventListener('click', function(event) {
   event.preventDefault(); // 버튼 클릭 시 기본 동작인 submit 방지
   fileInput.value = ""; // 파일 선택란 비우기
   fileInfo.textContent = '선택된 파일 없음'; // 파일 정보 초기화
});
});
/* 파일 첨부 및 검증 E */


/* 라디오 버튼 2번 클릭 시 선택 취소 S */
document.addEventListener("DOMContentLoaded", function() {
const radioButtons = document.querySelectorAll('input[type="radio"]');

radioButtons.forEach(function(radioButton) {
    radioButton.addEventListener("click", function() {
        if (this.previousValue === "checked") {
            this.checked = false;
            this.previousValue = false;
        } else {
            this.previousValue = this.checked ? "checked" : "unchecked";
        }
    });
});
});
/* 라디오 버튼 2번 클릭 시 선택 취소 E */


/* 분류에 따라 보여지는 form 변경 S */
document.addEventListener('DOMContentLoaded', function() {
// 분류 선택 요소
const categorySelect = document.getElementById('type');
// 공통 필드
const allFields = document.querySelectorAll('.all');
// 공지사항 관련 필드
const noticeFields = document.querySelectorAll('.noticeRow');
// FAQ 관련 필드
const faqFields = document.querySelectorAll('.faqRow');

// 초기 상태 설정
toggleFields(categorySelect.value);

// 분류 선택 시 이벤트 리스너 추가
categorySelect.addEventListener('change', function() {
toggleFields(categorySelect.value);
});

// 필드를 보이거나 숨기는 함수 정의
function toggleFields(category) {
if (category === 'notice') {
    noticeFields.forEach(function(field) {
        field.style.display = 'table-row'; // 공지사항 필드 표시
    });
    faqFields.forEach(function(field) {
        field.style.display = 'none'; // FAQ 필드 숨김
    });
} else if (category === 'faq') {
    noticeFields.forEach(function(field) {
        field.style.display = 'none'; // 공지사항 필드 숨김
    });
    faqFields.forEach(function(field) {
        field.style.display = 'table-row'; // FAQ 필드 표시
    });
}
}
});
/* 분류에 따라 보여지는 form 변경 E */


/* 게시 예정일 선택 시 달력 표출 S */
document.addEventListener('DOMContentLoaded', function() {
// 게시 예정일 라디오 버튼
const expectedPostingDate = document.getElementById('expectedPostingDate');
// 등록 즉시 게시 라디오 버튼
const immediately = document.getElementById('immediately');
// 달력
const calendar = document.getElementById('calendar');
// 등록하기 버튼
const addButton = document.getElementById('addNoticeFaq');

// 내일 날짜 가져오기
const TOMORROW = new Date();
TOMORROW.setDate(TOMORROW.getDate() + 1);
const TOMORROW_FORMATTED = TOMORROW.toISOString().split('T')[0];

// 게시 예정일 선택 시 이벤트 리스너 추가
expectedPostingDate.addEventListener('change', function() {
    if (this.checked) {
        calendar.style.display = "inline-block";
        // 내일부터 선택 가능하도록 min 속성 설정
        calendar.setAttribute("min", TOMORROW_FORMATTED);
    } else {
        calendar.style.display = "none";
        // min 속성 제거
        calendar.removeAttribute("min");
    }
});

// 등록 즉시 게시 선택 시 달력 숨기기
immediately.addEventListener('change', function() {
    if (this.checked) {
        calendar.style.display = "none";
        expectedPostingDate.checked = false; // 게시 예정일 체크 해제
    }
});
});
/* 게시 예정일 선택 시 달력 표출 E */


/* 댓글 관련 js 코드 S */

// 댓글 목록을 불러와서 화면에 표시하는 함수
function loadComments() {
    fetch('/api/comments')
    .then(response => response.json())
    .then(data => {
        const commentList = document.getElementById('commentList');
        // 기존 댓글 삭제
        commentList.innerHTML = '';
        // 받아온 댓글 데이터를 리스트로 변환하여 화면에 추가
        data.forEach(comment => {
            const listItem = document.createElement('li');
            listItem.textContent = comment.content;
            commentList.appendChild(listItem);
        });
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// 페이지 로드 시 댓글 목록 불러오기
document.addEventListener('DOMContentLoaded', function() {
    loadComments();
});

// 댓글 입력 폼 submit 이벤트 리스너 추가
document.getElementById('commentForm').addEventListener('submit', function(event) {
    event.preventDefault(); // 기본 동작 방지

    // 입력된 댓글 내용 가져오기
    const content = document.getElementById('commentContent').value;

    // AJAX를 사용하여 댓글 생성 API 호출
    fetch('/api/comments', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ content: content })
    })
    .then(response => response.json())
    .then(data => {
        // 댓글 생성 성공 시 댓글 목록 다시 불러와서 화면 갱신
        loadComments();
        // 입력 폼 비우기
        document.getElementById('commentContent').value = '';
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

/* 댓글 관련 js 코드 E */
</script>

</section>
</html>